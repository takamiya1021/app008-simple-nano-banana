<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template 7 TDD Tests</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .test-pass { background-color: #e8f5e8; }
        .test-fail { background-color: #ffe8e8; }
        .test-result { font-weight: bold; margin: 10px 0; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <h1>Template 7ï¼ˆã‚¹ãƒ†ãƒƒã‚«ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼‰TDD ãƒ†ã‚¹ãƒˆ</h1>

    <div id="test-results"></div>

    <!-- ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ€ãƒŸãƒ¼HTMLã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ -->
    <div style="display: none;">
        <!-- mode-tabè¦ç´ è¿½åŠ  -->
        <button class="mode-tab" data-mode="template7">Template 7</button>

        <!-- switchModeãŒå‚ç…§ã™ã‚‹ä»–ã®è¦ç´ ã‚‚è¿½åŠ  -->
        <div class="prompt-section hidden"></div>
        <div class="template5-form hidden"></div>
        <div class="template6-form hidden"></div>

        <select id="t7-style">
            <option value="kawaii">Kawaii</option>
            <option value="minimal">Minimal</option>
        </select>
        <input id="t7-subject" type="text" value="cat">
        <input id="t7-characteristics" type="text" value="orange, sitting">
        <select id="t7-background">
            <option value="transparent">Transparent</option>
            <option value="solid">Solid Color</option>
        </select>
        <textarea id="t7-preview"></textarea>
        <button id="generate-template7">Generate</button>

        <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆç”¨ã®è¦ç´  -->
        <section class="section template7-form hidden">
            <h2>ğŸ·ï¸ ã‚¹ãƒ†ãƒƒã‚«ãƒ¼ãƒ¢ãƒ¼ãƒ‰</h2>
            <!-- ãƒ†ã‚¹ãƒˆç”¨ã®æœ€å°æ§‹æˆ -->
        </section>
    </div>

    <script src="js/app.js"></script>
    <script>
        // TDD Redæ®µéšï¼šå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

        let testResults = [];

        function runTest(testName, testFunction) {
            try {
                const result = testFunction();
                if (result) {
                    testResults.push({ name: testName, status: 'PASS', message: result });
                } else {
                    testResults.push({ name: testName, status: 'FAIL', message: 'Test returned false' });
                }
            } catch (error) {
                testResults.push({ name: testName, status: 'FAIL', message: error.message });
            }
        }

        // ãƒ†ã‚¹ãƒˆ1: Template 7ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®å­˜åœ¨ç¢ºèª
        runTest('Template 7 Form Elements Exist', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // ã“ã‚Œã‚‰ã®è¦ç´ ã¯å­˜åœ¨ã—ãªã„ã®ã§å¤±æ•—ã™ã‚‹ï¼ˆRedæ®µéšï¼‰
            const hasStyleSelect = !!app.elements.t7Style;
            const hasSubjectInput = !!app.elements.t7Subject;
            const hasCharacteristicsInput = !!app.elements.t7Characteristics;
            const hasBackgroundSelect = !!app.elements.t7Background;
            const hasPreview = !!app.elements.t7Preview;
            const hasGenerateBtn = !!app.elements.generateTemplate7Btn;

            if (!hasStyleSelect) throw new Error('t7Style element not found');
            if (!hasSubjectInput) throw new Error('t7Subject element not found');
            if (!hasCharacteristicsInput) throw new Error('t7Characteristics element not found');
            if (!hasBackgroundSelect) throw new Error('t7Background element not found');
            if (!hasPreview) throw new Error('t7Preview element not found');
            if (!hasGenerateBtn) throw new Error('generateTemplate7Btn element not found');

            return 'All Template 7 elements found';
        });

        // ãƒ†ã‚¹ãƒˆ2: Template 7ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆæ©Ÿèƒ½
        runTest('Template 7 Prompt Generation', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // updateTemplate7Preview ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ãªã„ã®ã§å¤±æ•—ã™ã‚‹ï¼ˆRedæ®µéšï¼‰
            if (typeof app.updateTemplate7Preview !== 'function') {
                throw new Error('updateTemplate7Preview method not found');
            }

            // ãƒ†ã‚¹ãƒˆç”¨ã®å€¤ã‚’è¨­å®š
            app.elements.t7Style.value = 'kawaii';
            app.elements.t7Subject.value = 'cat';
            app.elements.t7Characteristics.value = 'orange, sitting';
            app.elements.t7Background.value = 'transparent';

            // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚’å®Ÿè¡Œ
            app.updateTemplate7Preview();

            // æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ã‚’ãƒã‚§ãƒƒã‚¯
            const expectedPrompt = 'A kawaii style sticker featuring cat with orange, sitting. The design should have clean edges, vibrant colors, and work well as a standalone sticker. transparent background.';
            const actualPrompt = app.elements.t7Preview.value;

            if (actualPrompt !== expectedPrompt) {
                throw new Error(`Expected: ${expectedPrompt}, but got: ${actualPrompt}`);
            }

            return 'Template 7 prompt generated correctly';
        });

        // ãƒ†ã‚¹ãƒˆ3: Template 7ç”Ÿæˆæ©Ÿèƒ½
        runTest('Template 7 Generation Function', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // generateTemplate7 ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ãªã„ã®ã§å¤±æ•—ã™ã‚‹ï¼ˆRedæ®µéšï¼‰
            if (typeof app.generateTemplate7 !== 'function') {
                throw new Error('generateTemplate7 method not found');
            }

            return 'Template 7 generation function exists';
        });

        // ãƒ†ã‚¹ãƒˆ4: Template 7ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        runTest('Template 7 Mode Switch', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // template7ãƒ¢ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„ã®ã§å¤±æ•—ã™ã‚‹ï¼ˆRedæ®µéšï¼‰
            app.switchMode('template7');

            if (app.currentMode !== 'template7') {
                throw new Error(`Expected mode 'template7', but got '${app.currentMode}'`);
            }

            // template7ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const template7Form = document.querySelector('.template7-form');
            if (!template7Form) {
                throw new Error('template7-form element not found');
            }

            if (template7Form.classList.contains('hidden')) {
                throw new Error('template7-form should be visible when template7 mode is active');
            }

            return 'Template 7 mode switch works correctly';
        });

        // ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º
        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            let html = '';

            testResults.forEach(test => {
                const cssClass = test.status === 'PASS' ? 'test-pass' : 'test-fail';
                html += `
                    <div class="test-section ${cssClass}">
                        <div class="test-result">${test.status}: ${test.name}</div>
                        <div>${test.message}</div>
                    </div>
                `;
            });

            const passCount = testResults.filter(t => t.status === 'PASS').length;
            const failCount = testResults.filter(t => t.status === 'FAIL').length;

            html = `
                <div class="test-result">
                    Test Summary: ${passCount} PASS, ${failCount} FAIL
                </div>
                ${html}
            `;

            resultsDiv.innerHTML = html;
        }

        // DOMContentLoadedå¾Œã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                displayResults();
            }, 100);
        });
    </script>
</body>
</html>