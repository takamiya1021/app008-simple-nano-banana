<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template 8 TDD Tests</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .test-pass { background-color: #e8f5e8; }
        .test-fail { background-color: #ffe8e8; }
        .test-result { font-weight: bold; margin: 10px 0; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <h1>Template 8（テキスト統合モード）TDD テスト</h1>

    <div id="test-results"></div>

    <!-- テスト用のダミーHTMLエレメント -->
    <div style="display: none;">
        <!-- mode-tab要素追加 -->
        <button class="mode-tab" data-mode="template8">Template 8</button>

        <!-- switchModeが参照する他の要素も追加 -->
        <div class="prompt-section hidden"></div>
        <div class="template5-form hidden"></div>
        <div class="template6-form hidden"></div>
        <div class="template7-form hidden"></div>

        <input id="t8-text" type="text" value="Hello World">
        <select id="t8-design-type">
            <option value="poster">Poster</option>
            <option value="logo">Logo</option>
        </select>
        <select id="t8-font-style">
            <option value="handwritten">Handwritten</option>
            <option value="print">Print</option>
        </select>
        <select id="t8-placement">
            <option value="center">Center</option>
            <option value="top">Top</option>
        </select>
        <select id="t8-color-theme">
            <option value="colorful">Colorful</option>
            <option value="monochrome">Monochrome</option>
        </select>
        <textarea id="t8-preview"></textarea>
        <button id="generate-template8">Generate</button>

        <!-- モード切り替えテスト用の要素 -->
        <section class="section template8-form hidden">
            <h2>📝 テキスト統合モード</h2>
            <!-- テスト用の最小構成 -->
        </section>
    </div>

    <script src="js/app.js"></script>
    <script>
        // TDD Red段階：失敗するテストケース

        let testResults = [];

        function runTest(testName, testFunction) {
            try {
                const result = testFunction();
                if (result) {
                    testResults.push({ name: testName, status: 'PASS', message: result });
                } else {
                    testResults.push({ name: testName, status: 'FAIL', message: 'Test returned false' });
                }
            } catch (error) {
                testResults.push({ name: testName, status: 'FAIL', message: error.message });
            }
        }

        // テスト1: Template 8フォーム要素の存在確認
        runTest('Template 8 Form Elements Exist', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // これらの要素は存在しないので失敗する（Red段階）
            const hasTextInput = !!app.elements.t8Text;
            const hasDesignTypeSelect = !!app.elements.t8DesignType;
            const hasFontStyleSelect = !!app.elements.t8FontStyle;
            const hasPlacementSelect = !!app.elements.t8Placement;
            const hasColorThemeSelect = !!app.elements.t8ColorTheme;
            const hasPreview = !!app.elements.t8Preview;
            const hasGenerateBtn = !!app.elements.generateTemplate8Btn;

            if (!hasTextInput) throw new Error('t8Text element not found');
            if (!hasDesignTypeSelect) throw new Error('t8DesignType element not found');
            if (!hasFontStyleSelect) throw new Error('t8FontStyle element not found');
            if (!hasPlacementSelect) throw new Error('t8Placement element not found');
            if (!hasColorThemeSelect) throw new Error('t8ColorTheme element not found');
            if (!hasPreview) throw new Error('t8Preview element not found');
            if (!hasGenerateBtn) throw new Error('generateTemplate8Btn element not found');

            return 'All Template 8 elements found';
        });

        // テスト2: Template 8プロンプト生成機能
        runTest('Template 8 Prompt Generation', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // updateTemplate8Preview メソッドが存在しないので失敗する（Red段階）
            if (typeof app.updateTemplate8Preview !== 'function') {
                throw new Error('updateTemplate8Preview method not found');
            }

            // テスト用の値を設定
            app.elements.t8Text.value = 'Hello World';
            app.elements.t8DesignType.value = 'poster';
            app.elements.t8FontStyle.value = 'handwritten';
            app.elements.t8Placement.value = 'center';
            app.elements.t8ColorTheme.value = 'colorful';

            // プロンプト生成を実行
            app.updateTemplate8Preview();

            // 期待される出力をチェック
            const expectedPrompt = 'Create a poster with the text \'Hello World\' in handwritten font. Position the text center with colorful color scheme. The design should be clean and readable.';
            const actualPrompt = app.elements.t8Preview.value;

            if (actualPrompt !== expectedPrompt) {
                throw new Error(`Expected: ${expectedPrompt}, but got: ${actualPrompt}`);
            }

            return 'Template 8 prompt generated correctly';
        });

        // テスト3: Template 8生成機能
        runTest('Template 8 Generation Function', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // generateTemplate8 メソッドが存在しないので失敗する（Red段階）
            if (typeof app.generateTemplate8 !== 'function') {
                throw new Error('generateTemplate8 method not found');
            }

            return 'Template 8 generation function exists';
        });

        // テスト4: Template 8モード切り替え
        runTest('Template 8 Mode Switch', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // template8モードが存在しないので失敗する（Red段階）
            app.switchMode('template8');

            if (app.currentMode !== 'template8') {
                throw new Error(`Expected mode 'template8', but got '${app.currentMode}'`);
            }

            // template8フォームが表示されるかチェック
            const template8Form = document.querySelector('.template8-form');
            if (!template8Form) {
                throw new Error('template8-form element not found');
            }

            if (template8Form.classList.contains('hidden')) {
                throw new Error('template8-form should be visible when template8 mode is active');
            }

            return 'Template 8 mode switch works correctly';
        });

        // テスト5: Template 8テキスト入力バリデーション
        runTest('Template 8 Text Input Validation', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // テキストが空の場合の処理をテスト
            app.elements.t8Text.value = '';

            if (typeof app.updateTemplate8Preview !== 'function') {
                throw new Error('updateTemplate8Preview method not found');
            }

            app.updateTemplate8Preview();

            const expectedPrompt = 'フォームを入力すると、ここにプロンプトが表示されます';
            const actualPrompt = app.elements.t8Preview.value;

            if (actualPrompt !== expectedPrompt) {
                throw new Error(`Expected empty text to show placeholder, but got: ${actualPrompt}`);
            }

            return 'Template 8 text validation works correctly';
        });

        // テスト結果を表示
        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            let html = '';

            testResults.forEach(test => {
                const cssClass = test.status === 'PASS' ? 'test-pass' : 'test-fail';
                html += `
                    <div class="test-section ${cssClass}">
                        <div class="test-result">${test.status}: ${test.name}</div>
                        <div>${test.message}</div>
                    </div>
                `;
            });

            const passCount = testResults.filter(t => t.status === 'PASS').length;
            const failCount = testResults.filter(t => t.status === 'FAIL').length;

            html = `
                <div class="test-result">
                    Test Summary: ${passCount} PASS, ${failCount} FAIL
                </div>
                ${html}
            `;

            resultsDiv.innerHTML = html;
        }

        // DOMContentLoaded後にテスト実行
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                displayResults();
            }, 100);
        });
    </script>
</body>
</html>