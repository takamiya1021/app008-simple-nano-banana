<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template 8 TDD Tests</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .test-pass { background-color: #e8f5e8; }
        .test-fail { background-color: #ffe8e8; }
        .test-result { font-weight: bold; margin: 10px 0; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <h1>Template 8ï¼ˆãƒ†ã‚­ã‚¹ãƒˆçµ±åˆãƒ¢ãƒ¼ãƒ‰ï¼‰TDD ãƒ†ã‚¹ãƒˆ</h1>

    <div id="test-results"></div>

    <!-- ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ€ãƒŸãƒ¼HTMLã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ -->
    <div style="display: none;">
        <!-- mode-tabè¦ç´ è¿½åŠ  -->
        <button class="mode-tab" data-mode="template8">Template 8</button>

        <!-- switchModeãŒå‚ç…§ã™ã‚‹ä»–ã®è¦ç´ ã‚‚è¿½åŠ  -->
        <div class="prompt-section hidden"></div>
        <div class="template5-form hidden"></div>
        <div class="template6-form hidden"></div>
        <div class="template7-form hidden"></div>

        <input id="t8-text" type="text" value="Hello World">
        <select id="t8-design-type">
            <option value="poster">Poster</option>
            <option value="logo">Logo</option>
        </select>
        <select id="t8-font-style">
            <option value="handwritten">Handwritten</option>
            <option value="print">Print</option>
        </select>
        <select id="t8-placement">
            <option value="center">Center</option>
            <option value="top">Top</option>
        </select>
        <select id="t8-color-theme">
            <option value="colorful">Colorful</option>
            <option value="monochrome">Monochrome</option>
        </select>
        <textarea id="t8-preview"></textarea>
        <button id="generate-template8">Generate</button>

        <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆç”¨ã®è¦ç´  -->
        <section class="section template8-form hidden">
            <h2>ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆçµ±åˆãƒ¢ãƒ¼ãƒ‰</h2>
            <!-- ãƒ†ã‚¹ãƒˆç”¨ã®æœ€å°æ§‹æˆ -->
        </section>
    </div>

    <script src="js/app.js"></script>
    <script>
        // TDD Redæ®µéšï¼šå¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

        let testResults = [];

        function runTest(testName, testFunction) {
            try {
                const result = testFunction();
                if (result) {
                    testResults.push({ name: testName, status: 'PASS', message: result });
                } else {
                    testResults.push({ name: testName, status: 'FAIL', message: 'Test returned false' });
                }
            } catch (error) {
                testResults.push({ name: testName, status: 'FAIL', message: error.message });
            }
        }

        // ãƒ†ã‚¹ãƒˆ1: Template 8ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®å­˜åœ¨ç¢ºèª
        runTest('Template 8 Form Elements Exist', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // ã“ã‚Œã‚‰ã®è¦ç´ ã¯å­˜åœ¨ã—ãªã„ã®ã§å¤±æ•—ã™ã‚‹ï¼ˆRedæ®µéšï¼‰
            const hasTextInput = !!app.elements.t8Text;
            const hasDesignTypeSelect = !!app.elements.t8DesignType;
            const hasFontStyleSelect = !!app.elements.t8FontStyle;
            const hasPlacementSelect = !!app.elements.t8Placement;
            const hasColorThemeSelect = !!app.elements.t8ColorTheme;
            const hasPreview = !!app.elements.t8Preview;
            const hasGenerateBtn = !!app.elements.generateTemplate8Btn;

            if (!hasTextInput) throw new Error('t8Text element not found');
            if (!hasDesignTypeSelect) throw new Error('t8DesignType element not found');
            if (!hasFontStyleSelect) throw new Error('t8FontStyle element not found');
            if (!hasPlacementSelect) throw new Error('t8Placement element not found');
            if (!hasColorThemeSelect) throw new Error('t8ColorTheme element not found');
            if (!hasPreview) throw new Error('t8Preview element not found');
            if (!hasGenerateBtn) throw new Error('generateTemplate8Btn element not found');

            return 'All Template 8 elements found';
        });

        // ãƒ†ã‚¹ãƒˆ2: Template 8ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆæ©Ÿèƒ½
        runTest('Template 8 Prompt Generation', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // updateTemplate8Preview ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ãªã„ã®ã§å¤±æ•—ã™ã‚‹ï¼ˆRedæ®µéšï¼‰
            if (typeof app.updateTemplate8Preview !== 'function') {
                throw new Error('updateTemplate8Preview method not found');
            }

            // ãƒ†ã‚¹ãƒˆç”¨ã®å€¤ã‚’è¨­å®š
            app.elements.t8Text.value = 'Hello World';
            app.elements.t8DesignType.value = 'poster';
            app.elements.t8FontStyle.value = 'handwritten';
            app.elements.t8Placement.value = 'center';
            app.elements.t8ColorTheme.value = 'colorful';

            // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆã‚’å®Ÿè¡Œ
            app.updateTemplate8Preview();

            // æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ã‚’ãƒã‚§ãƒƒã‚¯
            const expectedPrompt = 'Create a poster with the text \'Hello World\' in handwritten font. Position the text center with colorful color scheme. The design should be clean and readable.';
            const actualPrompt = app.elements.t8Preview.value;

            if (actualPrompt !== expectedPrompt) {
                throw new Error(`Expected: ${expectedPrompt}, but got: ${actualPrompt}`);
            }

            return 'Template 8 prompt generated correctly';
        });

        // ãƒ†ã‚¹ãƒˆ3: Template 8ç”Ÿæˆæ©Ÿèƒ½
        runTest('Template 8 Generation Function', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // generateTemplate8 ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ãªã„ã®ã§å¤±æ•—ã™ã‚‹ï¼ˆRedæ®µéšï¼‰
            if (typeof app.generateTemplate8 !== 'function') {
                throw new Error('generateTemplate8 method not found');
            }

            return 'Template 8 generation function exists';
        });

        // ãƒ†ã‚¹ãƒˆ4: Template 8ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        runTest('Template 8 Mode Switch', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // template8ãƒ¢ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„ã®ã§å¤±æ•—ã™ã‚‹ï¼ˆRedæ®µéšï¼‰
            app.switchMode('template8');

            if (app.currentMode !== 'template8') {
                throw new Error(`Expected mode 'template8', but got '${app.currentMode}'`);
            }

            // template8ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            const template8Form = document.querySelector('.template8-form');
            if (!template8Form) {
                throw new Error('template8-form element not found');
            }

            if (template8Form.classList.contains('hidden')) {
                throw new Error('template8-form should be visible when template8 mode is active');
            }

            return 'Template 8 mode switch works correctly';
        });

        // ãƒ†ã‚¹ãƒˆ5: Template 8ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        runTest('Template 8 Text Input Validation', () => {
            const app = new NanoBananaApp();
            app.bindElements();

            // ãƒ†ã‚­ã‚¹ãƒˆãŒç©ºã®å ´åˆã®å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆ
            app.elements.t8Text.value = '';

            if (typeof app.updateTemplate8Preview !== 'function') {
                throw new Error('updateTemplate8Preview method not found');
            }

            app.updateTemplate8Preview();

            const expectedPrompt = 'ãƒ•ã‚©ãƒ¼ãƒ ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã“ã“ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™';
            const actualPrompt = app.elements.t8Preview.value;

            if (actualPrompt !== expectedPrompt) {
                throw new Error(`Expected empty text to show placeholder, but got: ${actualPrompt}`);
            }

            return 'Template 8 text validation works correctly';
        });

        // ãƒ†ã‚¹ãƒˆçµæœã‚’è¡¨ç¤º
        function displayResults() {
            const resultsDiv = document.getElementById('test-results');
            let html = '';

            testResults.forEach(test => {
                const cssClass = test.status === 'PASS' ? 'test-pass' : 'test-fail';
                html += `
                    <div class="test-section ${cssClass}">
                        <div class="test-result">${test.status}: ${test.name}</div>
                        <div>${test.message}</div>
                    </div>
                `;
            });

            const passCount = testResults.filter(t => t.status === 'PASS').length;
            const failCount = testResults.filter(t => t.status === 'FAIL').length;

            html = `
                <div class="test-result">
                    Test Summary: ${passCount} PASS, ${failCount} FAIL
                </div>
                ${html}
            `;

            resultsDiv.innerHTML = html;
        }

        // DOMContentLoadedå¾Œã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                displayResults();
            }, 100);
        });
    </script>
</body>
</html>